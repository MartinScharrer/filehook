%&pdflatex
%\RequirePackage{currfile}[2010/12/28]
\documentclass{filehooktest}

\AtBeginOfInputs{\testmessage{At Begin Of Inputs (file: \filehookfilename)}}
\AtEndOfInputs{\testmessage{At End Of Inputs (file: \filehookfilename)}}
\AtBeginOfInputFile{input}{\testmessage{At Begin Of Input File `input'}}
\AtEndOfInputFile{input}{\testmessage{At End Of Input File `input'}}

\AtBeginOfFiles{\testmessage{At Begin Of Files (file: \filehookfilename)}}
\AtEndOfFiles{\testmessage{At End Of Files (file: \filehookfilename)}}
\AtBeginOfFile{input}{\testmessage{At Begin Of File `input'}\testmessage{}\InputIfFileExists{sub}{}{}\testmessage{}}
\AtEndOfFile{input}{\testmessage{At End Of File `input'}}
\AtBeginOfFile{sub}{\testmessage{At Begin Of File `sub'}}
\AtEndOfFile{sub}{\testmessage{At End Of File `sub'}}

\AtBeginOfEveryFile{\testmessage{At Begin Of Every File (file: \filehookfilename)}}
\AtEndOfEveryFile{\testmessage{At End Of Every File (file: \filehookfilename)}}

%\makeatletter
%\def\filehook@parsefile#1{%
%    \edef\filehookfilearg{#1}%
%    \def\filehookfilename{\currfilename}%
%}
%\makeatother

\begin{document}

\begin{test}{\jobname}
\testmessage{Main file before input file}
\input{input}
\testmessage{Main file after input file}

\reference{%
Main file before input file
At Begin Of Every File (file: input.tex)
At Begin Of Input File `input'
At Begin Of Inputs (file: input.tex)
At Begin Of File `input'

At Begin Of Every File (file: sub.tex)
At Begin Of File `sub'
At Begin Of Files (file: sub.tex)
Content of Sub File
At End Of Files (file: sub.tex)
At End Of File `sub'
At End Of Every File (file: sub.tex)

At Begin Of Files (file: input.tex)
Content of Input File
At End Of Files (file: input.tex)
At End Of File `input'
At End Of Inputs (file: input.tex)
At End Of Input File `input'
At End Of Every File (file: input.tex)
Main file after input file
}%
\end{test}

\end{document}

