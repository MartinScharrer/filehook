%&pdflatex
%\RequirePackage{currfile}[2010/12/28]
\documentclass{memoir}
\usepackage{filehooktest}

\AtBeginOfInputs{\testmessage{At Begin Of Inputs}}
\AtEndOfInputs{\testmessage{At End Of Inputs}}
\AtBeginOfInputFile{inputsub}{\testmessage{At Begin Of Input File `inputsub'}}
\AtEndOfInputFile{inputsub}{\testmessage{At End Of Input File `inputsub'}}

\AtBeginOfFiles{\testmessage{At Begin Of Files}}
\AtEndOfFiles{\testmessage{At End Of Files}}
\AtBeginOfFile{inputsub}{\testmessage{At Begin Of File `inputsub'}}
\AtEndOfFile{inputsub}{\testmessage{At End Of File `inputsub'}}
\AtBeginOfFile{sub}{\testmessage{At Begin Of File `sub'}}
\AtEndOfFile{sub}{\testmessage{At End Of File `sub'}}

\AtBeginOfEveryFile{\testmessage{At Begin Of Every File}}
\AtEndOfEveryFile{\testmessage{At End Of Every File}}

%\makeatletter
%\def\filehook@parsefile#1{%
%    \edef\filehookfilearg{#1}%
%    \def\filehookfilename{\currfilename}%
%}
%\makeatother

\begin{document}

\begin{test}{\jobname}
\testmessage{Main file before inputsub file}
\input{inputsub}
\testmessage{Main file after inputsub file}

\reference{%
Main file before inputsub file
At Begin Of Every File
At Begin Of Input File `inputsub'
At Begin Of Inputs
At Begin Of File `inputsub'
At Begin Of Files
Content of Input File

At Begin Of Every File
At Begin Of File `sub'
At Begin Of Files
Content of Sub File
At End Of Files
At End Of File `sub'
At End Of Every File

At End Of Files
At End Of File `inputsub'
At End Of Inputs
At End Of Input File `inputsub'
At End Of Every File
Main file after inputsub file
}%
\end{test}

\end{document}

