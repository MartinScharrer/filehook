%&pdflatex
%\RequirePackage{currfile}[2010/12/28]
\RequirePackage{scrlfile}
\documentclass{filehooktest}

\AtBeginOfInputs{\testmessage{At Begin Of Inputs (file: \filehookfilename)}}
\AtEndOfInputs{\testmessage{At End Of Inputs (file: \filehookfilename)}}
\AtBeginOfInputFile{inputsub}{\testmessage{At Begin Of Input File `inputsub'}}
\AtEndOfInputFile{inputsub}{\testmessage{At End Of Input File `inputsub'}}

\AtBeginOfFiles{\testmessage{At Begin Of Files (file: \filehookfilename)}}
\AtEndOfFiles{\testmessage{At End Of Files (file: \filehookfilename)}}
\AtBeginOfFile{inputsub}{\testmessage{At Begin Of File `inputsub'}}
\AtEndOfFile{inputsub}{\testmessage{At End Of File `inputsub'}}
\AtBeginOfFile{sub}{\testmessage{At Begin Of File `sub'}}
\AtEndOfFile{sub}{\testmessage{At End Of File `sub'}}

\AtBeginOfEveryFile{\testmessage{At Begin Of Every File (file: \filehookfilename)}}
\AtEndOfEveryFile{\testmessage{At End Of Every File (file: \filehookfilename)}}

%\makeatletter
%\def\filehook@parsefile#1{%
%    \edef\filehookfilearg{#1}%
%    \def\filehookfilename{\currfilename}%
%}
%\makeatother

\begin{document}

\begin{test}{\jobname}
\testmessage{Main file before inputsub file}
\input{inputsub}
\testmessage{Main file after inputsub file}

\reference{%
Main file before inputsub file
At Begin Of Every File (file: inputsub.tex)
At Begin Of Input File `inputsub'
At Begin Of Inputs (file: inputsub.tex)
At Begin Of File `inputsub'
At Begin Of Files (file: inputsub.tex)
Content of Input File

At Begin Of Every File (file: sub.tex)
At Begin Of File `sub'
At Begin Of Files (file: sub.tex)
Content of Sub File
At End Of Files (file: sub.tex)
At End Of File `sub'
At End Of Every File (file: sub.tex)

At End Of Files (file: inputsub.tex)
At End Of File `inputsub'
At End Of Inputs (file: inputsub.tex)
At End Of Input File `inputsub'
At End Of Every File (file: inputsub.tex)
Main file after inputsub file
}%
\end{test}

\end{document}

